---
# yaml-language-server: $schema=../docs-resources/schemas/defs-schema.json

$schema: ../docs-resources/schemas/defs-schema.json#

# Used to create normative rules for supervisor.adoc file.
# Tags refer to anchors in any adoc file for any ISA manual.

chapter_name: Supervisor Mode

normative_rule_definitions:
  - names: [sstatus_sz, sstatus_mode, sstatus_acc]
    tags: ["norm:sstatus"]

  - names: [sstatus-spp_sz, sstatus-spp_acc, sstatus-spp_op]
    tags: ["norm:sstatus-spp"]

  - names: [sstatus-sie_sz, sstatus-sie_acc, sstatus-sie_op]
    tags: ["norm:sstatus-sie"]

  - names: [sstatus-spie_sz, sstatus-spie_acc, sstatus-spie_op]
    tags: ["norm:sstatus-spie"]

  - names: [sstatus-uxl_acc, sstatus-uxl_op]
    tags: ["norm:sstatus-uxl"]
  - name: sstatus-uxl_sz
    tags: ["norm:sstatus-uxl_sz"]
  - name: sstatus-uxl_behavior
    tags: ["norm:sstatus-uxl_behavior"]

  - name: hint_sxlen_param
    tags: ["norm:hint_sxlen_param"]

  - names: [sstatus-mxr_sz, sstatus-mxr_acc, sstatus-mxr_op]
    tags: ["norm:sstatus-mxr"]

  - names: [sstatus-sum_sz, sstatus-sum_acc, sstatus-sum_op]
    tags: ["norm:sstatus-sum"]

  - name: sstatus-sum_satp-mode
    tags: ["norm:sstatus-sum_satp-mode"]

  - names: [sstatus-ube_sz, sstatus-ube_acc, sstatus-ube_op]
    tags: ["norm:sstatus-ube"]
  - name: sstatus-ube_implicit
    tags: ["norm:sstatus-ube_implicit"]

  - names: [sstatus-spelp_sz, sstatus-spelp_acc, sstatus-spelp_op, sstatus-spelp_Zicfilp]
    tags: ["norm:sstatus-spelp"]

  - names: [sstatus-sdt_sz, sstatus-sdt_acc, sstatus-sdt_op, sstatus-sdt_Ssdbltrp]
    tags: ["norm:sstatus-sdt"]

  - name: sstatus-sdt_sstatus-sie_overwrite
    tags: ["norm:sstatus-sdt_sstatus-sie_overwrite"]
  - name: sstatus-sdt_trap
    tags: ["norm:sstatus-sdt_trap"]
  - name: sstatus-sdt_sret
    tags: ["norm:sstatus-sdt_sret"]

  - names: [stvec_sz, stvec_acc, stvec_mode]
    tags: ["norm:stvec"]
  - name: stvec_op
    tags: ["norm:stvec_op"]
  - name: stvec_sz_base
    tags: ["norm:stvec_sz_base"]

  - names: [sip_sz, sie_sz, sip_mode, sie_mode]
    tags: ["norm:sip_sie"]
  - name: sie_sip_supervisor_strap
    tags: ["norm:sie_sip_supervisor_strap"]
  - name: sie_sip_strap_time_constraint
    tags: ["norm:sie_sip_strap_time_constraint"]
  - name: s_interrupt_priority
    tags: ["norm:s_interrupt_priority"]
  - name: sip_acc
    tags: ["norm:sip_acc"]
  - name: sip_op
    tags: ["norm:sip_op"]
  - name: sie_acc
    tags: ["norm:sie_acc"]

  - name: sip_sie_bits_sz
    tags: ["norm:sip_sie_bits_sz"]

  - names: [sip-seip_acc, sip-seip_op, sie-seie_acc, sie-seie_op]
    tags: ["norm:sip-seip_sie-seie"]

  - names: [sip-stip_acc, sip-stip_op, sie-stie_acc, sie-stie_op]
    tags: ["norm:sip-stip_sie-stie"]

  - names: [sip-ssip_acc, sip-ssip_op, sie-ssie_acc, sie-ssie_op]
    tags: ["norm:sip-ssip_sie-ssie"]

  - names: [sip-lcofip_Sscofpmf_acc, sip-lcofip_Sscofpmf_op, sie-lcofip_Sscofpmf_acc, sie-lcofip_Sscofpmf_op]
    tags: ["norm:sip_sie_Sscofpmf"]

  - names: [sip_unimpl_acc, sie_unimpl_acc]
    tags: ["norm:sip_sie_unimpl"]

  - names: [sip_priority_bit_order, sie_priority_bit_order]
    tags: ["norm:sip_sie_priority_bit_order"]

  - name: supervisor_timer_scheduling
    tags: ["norm:supervisor_timer_scheduling"]

  - names: [scounteren_sz, scounteren_mode]
    tags: ["norm:scounteren"]
  - name: scounteren_acc
    tags: ["norm:scounteren_acc"]
  - name: scounteren_op,
    tags: ["norm:scounteren_op"]

  - names: [sscratch_sz, sscratch_acc, sscratch_mode]
    tags: ["norm:sscratch"]

  - names: [sepc_sz, sepc_acc, sepc_op, sepc_mode]
    tags: ["norm:sepc"]
  - name: sepc_op_mask_ialign32
    tags: ["norm:sepc_op_mask_ialign32"]
  - name: sepc_acc_invalid_addr
    tags: ["norm:sepc_acc_invalid_addr"]
  - name: sepc_op_trap_write
    tags: ["norm:sepc_op_trap_write"]

  - names: [scause_sz, scause_acc, scause_op]
    tags: ["norm:scause"]

  - names: [scause-interrupt_sz, scause-interrupt_op]
    tags: ["norm:scause-interrupt"]
  - name: scause-exception_code_acc
    tags: ["norm:scause-exception_code_acc"]
  - name: scause-exception_code_sz
    tags: ["norm:scause-exception_code_sz"]


  - names: [stval_sz, stval_op, stval_mode]
    tags: ["norm:stval"]
  - name: stval_op_faulting_addr
    tags: ["norm:stval_op_faulting_addr"]
  - name: stval_op_breakpoint
    tags: ["norm:stval_op_breakpoint"]
  - name: stval_op_load_store_fault
    tags: ["norm:stval_op_load_store_fault"]
  - name: stval_faulting_address_variable_instr
    tags: ["norm:stval_faulting_address_variable_instr"]
  - name: stval_op_illegal_instr
    tags: ["norm:stval_op_illegal_instr"]
  - name: stval_op_illegal_instr_format
    tags: ["norm:stval_op_illegal_instr_format"]
  - name: stval_exception_info
    tags: ["norm:stval_exception_info"]
  - name: stval_op_other_traps
    tags: ["norm:stval_op_other_traps"]
  - name: stval_acc
    tags: ["norm:stval_acc"]

  - names: [senvcfg_sz, senvcfg_acc, senvcfg_mode]
    tags: ["norm:senvcfg"]

  - names: [senvcfg-fiom_sz, senvcfg-fiom_op]
    tags: ["norm:senvcfg-fiom"]
  - name: senvcfg-fiom_op_atomic
    tags: ["norm:senvcfg-fiom_op_atomic"]
  - name: senvcfg-fiom_acc
    tags: ["norm:senvcfg-fiom_acc"]

  - name: senvcfg-cbze_Zicboz
    tags: ["norm:senvcfg-cbze_Zicboz"]
  - names: [senvcfg-cbcfe_Zicbom, senvcfg-cbie_Zicbom]
    tags: ["norm:senvcfg-cbcfe-cbie_Zicbom"]

  - name: senvcfg-pmm_Ssnpm
    tags: ["norm:senvcfg-pmm_Ssnpm"]

  - names: [senvcfg-lpe_Zicfilp_acc, senvcfg-lpe_Zicfilp_op]
    tags: ["norm:senvcfg-lpe_Zicfilp"]

  - names: [senvcfg-sse_Zicfilp_sz, senvcfg-sse_Zicfilp_op]
    tags: ["norm:senvcfg-sse_Zicfilp"]

  - names: [satp_sz, satp_acc, satp_op, satp_mode]
    tags: ["norm:satp"]
  - names: [satp-mode_sz, satp-mode_acc, satp-mode_op]
    tags: ["norm:satp-mode"]
  - name: satp-mode_sxlen32
    tags: ["norm:satp-mode_sxlen32"]

  - name: satp-mode_sxlen64
    tags: ["norm:satp-mode_sxlen64"]
  - name: satp-mode_op_unsupported
    tags: ["norm:satp-mode_op_unsupported"]
  - name: satp-asidlen_param
    tags: ["norm:satp-asidlen"]
  - name: satp_op_active
    tags: ["norm:satp_op_active"]
  - name: satp_op_sfence-vma
    tags: ["norm:satp_op_sfence-vma"]

  - name: sfence-vma_op
    tags: ["norm:sfence-vma_op"]
  - name: sfence-vma_ordering
    tags: ["norm:sfence-vma_ordering"]
  - name: sfence-vma_invalidation
    tags: ["norm:sfence-vma_invalidation"]
  - name: sfence-vma_all_asid_va
    tags: ["norm:sfence-vma_all_asid_va"]
  - name: sfence-vma_asid_only
    tags: ["norm:sfence-vma_asid_only"]
  - name: sfence-vma_va_all_asid
    tags: ["norm:sfence-vma_va_all_asid"]
  - name: sfence-vma_va_asid
    tags: ["norm:sfence-vma_va_asid"]
  - name: sfence-vma_invalid_va
    tags: ["norm:sfence-vma_invalid_va"]
  - name: sfence-vma_rs2_bits
    tags: ["norm:sfence-vma_rs2_bits"]
  - name: sfence-vma_ordering_semantics
    tags: ["norm:sfence-vma_ordering_semantics"]
  - name: sfence-vma_implicit_access
    tags: ["norm:sfence-vma_implicit_access"]
  - name: sfence-vma-sum-mxr_effect
    tags: ["norm:sfence-vma-sum-mxr_effect"]
  - name: sfence-vma-mode_effect
    tags: ["norm:sfence-vma-mode_effect"]
  - name: sfence-vma-asid_effect
    tags: ["norm:sfence-vma-asid_effect"]

  - name: asid_hart_private
    tags: ["norm:asid_hart_private"]

  - name: satp-mode_roz_sfence_illegal_param
    tags: ["norm:satp-mode_roz_sfence_illegal_param"]
 
 # Sv32 mode selection
  - name: sv32_mode
    summary: Sv32 mode enables 32-bit paged virtual-memory system
    tags: ["norm:sv32_mode"]
  
  # Sv32 support requirement
  - name: sv32_support
    summary: Sv32 supported when SXLEN=32
    tags: ["norm:sv32_support"]
  
  # Virtual address space size
  - name: sv32_va_sz
    summary: Sv32 virtual address space is 32 bits
    tags: ["norm:sv32_va_sz"]
  
  # Translation mechanism
  - name: sv32_translation
    summary: Sv32 uses two-level page table for address translation
    tags: ["norm:sv32_translation"]
  
  # SV32 VPN-PPN size
  - name: sv32-vpn_ppn_sz
    summary: Sv32 VPN is 20 bits
    tags: ["norm:sv32-vpn_ppn_sz"]
  
  
  # Page offset handling
  - name: sv32_page_offset
    summary: Sv32 page offset is 12 bits and untranslated
    tags: ["norm:sv32_page_offset"]
  
  # PMP check requirement
  - name: vm_pmp_check
    summary: Sv32 physical addresses checked using PMP structures
    tags: ["norm:sv32_pmp_check"]

  # Page table structure
  - name: sv32_pte_count
    summary: Sv32 page tables contain 1024 PTEs
    tags: ["norm:sv32_pte_count"]
  
  - name: sv32_pte_sz
    summary: Sv32 PTE is 4 bytes
    tags: ["norm:sv32_pte_sz"]
  
  - name: sv32_pt_alignment
    summary: Sv32 page table is page-sized and page-aligned
    tags: ["norm:sv32_pt_alignment"]
  
  - name: sv32_satp_root
    summary: Root page table PPN stored in satp register
    tags: ["norm:sv32_satp_root"]
  
  # PTE format and fields
  - name: pte-v_op
    summary: V bit indicates PTE validity
    tags: ["norm:sv32_pte-v_op"]
  
  - name: pte-rwx_op
    summary: R, W, X bits indicate read, write, execute permissions
    tags: ["norm:sv32_pte-rwx_op"]
  
  - name: pte_leaf_pointer
    summary: PTE with R=W=X=0 is pointer, otherwise leaf
    tags: ["norm:sv32_pte_leaf_pointer"]
  
  - name: pte_w_requires_r
    summary: Writable pages must be marked readable
    tags: ["norm:sv32_pte_w_requires_r"]
  
  # Page fault exceptions
  - name: page_fault_fetch
    summary: Fetch from non-executable page raises fetch page-fault
    tags: ["norm:sv32_page_fault_fetch"]
  
  - name: page_fault_load
    summary: Load from non-readable page raises load page-fault
    tags: ["norm:sv32_page_fault_load"]
  
  - name: page_fault_store
    summary: Store to non-writable page raises store page-fault
    tags: ["norm:sv32_page_fault_store"]

  - name: page_fault_store_amo
    summary: Attempting AMO on unreadable page causes store page fault.
    tags: ["norm:page_fault_store_amo"]
  
  # PTE U bit
  - name: pte-u_op
    summary: U bit controls user-mode page accessibility
    tags: ["norm:sv32_pte-u_op"]
  
  # sstatus.SUM bit operation
  - name: sstatus-sum_op
    summary: SUM bit allows supervisor access to user pages
    tags: ["norm:sstatus-sum_op"]
  
  # PTE G bit
  - name: pte-g_op
    summary: G bit designates global mappings in all address spaces
    tags: ["norm:sv32_pte-g_op"]
  
  - name: pte-g_nonleaf
    summary: Non-leaf PTE G bit implies all subsequent mappings are global
    tags: ["norm:sv32_pte-g_nonleaf"]
  
  # PTE RSW field
  - name: pte-rsw_op
    summary: RSW field reserved for supervisor software, ignored by implementation
    tags: ["norm:sv32_pte-rsw_op"]
  
  # PTE A bit
  - name: pte-a_op
    summary: A bit indicates page has been read, written, or fetched from
    tags: ["norm:sv32_pte-a_op"]
  
  # PTE D bit
  - name: pte-d_op
    summary: D bit indicates page has been written
    tags: ["norm:sv32_pte-d_op"]
  
  
  # A/D bit behavior when Svade is implemented
  - name: pte_ad_svade_param
    summary: With Svade, page-fault raised when A or D bit needs setting
    tags: ["norm:pte_ad_svade_param"]
    description: "When Svade extension is implemented (SVADE=true)"
    kind: parameter

  # A/D bit behavior when Svade is NOT implemented
  - name: pte-a_update_nosvade_param]
    summary: Without Svade, hardware updates A and D bits automatically
    tags: ["norm:norm:pte-a_update_nosvade_param]"]
    description: "When Svade extension is not implemented (SVADE=false)"
    kind: parameter
  
  # A bit automatic update (when Svade not implemented)
  - name: pte-ad_update_nosvade_param
    summary: Without Svade, A and D bit set automatically on page access
    tags: ["norm:pte-a_update_nosvade_param"]
    description: "Applies when SVADE extension is disabled"
    kind: parameter
    
  # G-stage implicit access
  - name: gstage_implicit_access
    summary: G-stage pages may be accessed by VS-level memory management accesses
    tags: ["norm:gstage_implicit_access"]
    
  # Two-stage address translation PTE updates
  - name: gstage_vs_pte_update
    summary: Two-stage translation may update both VS-stage and G-stage PTEs
    tags: ["norm:gstage_vs_pte_update"]
  
  # PTE update atomicity
  - name: pte_update_atomic
    summary: PTE updates must be atomic with respect to other PTE accesses
    tags: ["norm:sv32_pte_update_atomic"]
  
  # A bit speculative updates
  - name: pte-a_speculative
    summary: A bit updates may be speculative
    tags: ["norm:sv32_pte-a_speculative"]
  
  # D bit exact updates
  - name: pte-d_exact
    summary: D bit updates must be exact and non-speculative
    tags: ["norm:sv32_pte-d_exact"]
  
  # G-stage D bit updates from VS access
  - name: gstage_pte-d_vs_access
    summary: G-stage D bit may be updated by VS-stage PTE access
    tags: ["norm:gstage_pte-d_vs_access"]
  
  # PTE update memory ordering
  - name: sv32_pte_update_order
    summary: PTE update must appear before causing memory access in global order
    tags: ["norm:sv32_pte_update_order"]
  
  # PTE update FENCE ordering
  - name: sv32_pte_update_fence
    summary: FENCE and acquire/release bits order PTE updates
    tags: ["norm:sv32_pte_update_fence"]
  
  # PTE update not atomic with memory access
  - name: sv32_pte_update_not_atomic_access
    summary: PTE update not required to be atomic with causing memory access
    tags: ["norm:sv32_pte_update_not_atomic_access"]
  
  # A/D bit updates with trap
  - name: sv32_pte_ad_trap
    summary: Trap may occur after A/D update but before memory access
    tags: ["norm:sv32_pte_ad_trap"]
  
  # Memory access must follow PTE update
  - name: sv32_pte_update_before_access
    summary: Memory access must not occur before PTE update is globally visible
    tags: ["norm:sv32_pte_update_before_access"]
  
  # Page table location requirements
  - name: sv32_pt_location
    summary: Page tables must be in memory with write access and RsrvEventual PMA
    tags: ["norm:sv32_pt_location"]
  
  # Uniform PTE update scheme
  - name: multihart_pte_update_scheme
    summary: All harts must use same PTE-update scheme
    tags: ["norm:sv32_pte_update_scheme"]
  
  # Megapage support
  - name: sv32_megapage_support
    summary: Sv32 supports 4 MiB megapages
    tags: ["norm:sv32_megapage_support"]
  
  # Megapage alignment
  - name: sv32_megapage_alignment
    summary: Megapages must be aligned to 4 MiB boundary
    tags: ["norm:sv32_megapage_alignment"]
  
  # Misaligned megapage page fault
  - name: sv32_page_fault_misaligned
    summary: Page-fault raised if physical address insufficiently aligned
    tags: ["norm:sv32_page_fault_misaligned"]
  
  # Non-leaf PTE reserved bits
  - name: sv32_pte_nonleaf_rsv
    summary: Non-leaf PTE D, A, U bits reserved for future standard use
    tags: ["norm:sv32_pte_nonleaf_rsv"]
  
  # Non-leaf PTE software clearing
  - name: sv32_pte_nonleaf_dauclear
    summary: Reserved non-leaf PTE D,A, and U bits must be cleared by software
    tags: ["norm:sv32_pte_nonleaf_clear"]
  
  # LR/SC reservation within page
  - name: sv32_lrsc_reservation
    summary: LR/SC reservation must lie within single 4 KiB physical page
    tags: ["norm:sv32_lrsc_reservation"]
  
  - name: pte_violate_pma_pmp_check
    summary: Access fault exception on violation of pma/pmp check.
    tags: ["norm:pte_violate_pma_pmp_check"]

  - name: pte_reserved_encoding_pagefault
    summary: If any of the reserved bit encodings are set, page fault exception will occur.
    tags: ["norm:pte_reserved_encoding_pagefault"]

  - name: smallest_pagetable_level
    summary: For sv32, smallest value of i(LEVELS-1) is 0.
    tags: ["norm:smallest_pagetable_level"]

  - name: misaligned_superpage_pagefault
    summary: If i is greater than 0 at a leaf pte, raise a pagefault exception.
    tags: ["norm:misaligned_superpage_pagefault"]

  - name: memory_access_by_pte_u_bit
    summary: If memory access is not allowed by pte u bit, a page fault is raised.
    tags: ["norm:memory_access_by_pte_u_bit"]

  - name: pte_rwx_shadowstack_check
    summary: Memory access permissions must respect PTE R/W/X bits under Shadow Stack Protection rules.
    tags: ["norm:pte_rwx_shadowstack_check"]

  - name: pte_rwx_access_check
    summary: Memory access permissions must respect PTE R/W/X bits.
    tags: ["norm:pte_rwx_access_check"]

  - name: pte_ad_svade_fault
    summary: For pte.a and pte.d bits cleared, we get a page fault exception if svade is implemented.
    tags: ["norm:pte_ad_svade_fault"]

  - name: pte_store_pma_pmp_check
    summary: If a store to a pte violates pmp/pma check, raise access-fault.
    tags: ["norm:pte_store_pma_pmp_check"]

  - name: address_translation_cache_behavior
    summary: Describes how implicit address-translation reads may be cached locally and the requirement of SFENCE.VMA to maintain coherence.
    tags: ["norm:address_translation_cache_behavior"]

  - name: pte_ad_memory_update
    summary: A/D bits are directly updated in the memory.
    tags: ["norm:pte_ad_memory_update"]

  - name: speculative_translation_execution
    summary: Restricts speculative address translation from setting D-bit, triggering exceptions, or caching invalid entries.
    tags: ["norm:speculative_translation_execution"]

  - name: addr_sign_extension_violation
    summary: Instruction fetch and memory access addresses must have bits 63â€“39 equal to bit 38 or cause a page-fault exception.
    tags: ["norm:addr_sign_extension_violation"]

  - name: page_table_alignment
    summary: Page table must be aligned to a page boundary.
    tags: ["norm:page_table_alignment"]

  - name: svnapot_bit63_reserved
    summary: Bit 63 must be zeroed by software if Svnapot is not implemented.
    tags: ["norm:svnapot_bit63_reserved"]

  - name: svnapot_bit_62_61_reserved
    summary: Bit 63 must be zeroed by software if Svnpbmt is not implemented.
    tags: ["norm:svnapot_bit_62_61_reserved"]

  - name: pte_reserved_bits_60_54
    summary: Bit 54 to 60 are reserved for future use.
    tags: ["norm:pte_reserved_bits_60_54"]

  - name: sv39_page_alignment
    summary: Pages must be virtually and physically aligned to boundary equal to its size.
    tags: ["norm:sv39_page_alignment"]

  - name: sv48_support
    summary: sv48 cannot be implemented without implementing sv39.
    tags: ["norm:sv48_support"]

  - name: sv48_sign_extension_violation
    summary: Bits 48 to 63 must be equal to bit 47.
    tags: ["norm:sv48_sign_extension_violation"]

  - name: sv57_support
    summary: sv 57 cannot be implemented without implementing sv48.
    tags: ["norm:sv57_support"]

  - name: sv57_sign_extension_violation
    summary: Bits 57 to 63 must be equal to bit 56.
    tags: ["norm:sv57_sign_extension_violation"]

    